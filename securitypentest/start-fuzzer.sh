#!/usr/bin/env bash
set -e

sh securitypentest/stop-fuzzer.sh

start_fuzzer() {
   echo "Starting security fuzzer..."
   weekly_image="owasp/zap2docker-weekly"
   stable_image="owasp/zap2docker-stable"
   bare_image="owasp/zap2docker-bare"
   lightweight_image="broadinstitute/lightweight-ci-scanner"
   container="securityscanner"

   docker pull $weekly_image
   docker run -v $(pwd):/zap/wrk/:rw -u zap --name $container -p 8090:8090 -d $weekly_image \
                    zap.sh -daemon \
                    -host 0.0.0.0 \
                    -port 8090 \
                    -config "api.disablekey=true" \
                    -config "api.addrs.addr.name=.*" \
                    -config "api.addrs.addr.regex=true"
   docker ps -a
}

start_fuzzer
